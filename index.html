<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Serial number lookup / Authentication checker</title>
    <style>
        :root { --brand:#207a69; --brand-600:#1a6658; --text:#0f172a; --muted:#64748b; --bg:#ffffff; --card:#f8fafc; --radius:14px; }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif; color:var(--text); background:var(--bg); display:flex; flex-direction:column;}
        header{background:var(--brand); color:#fff; padding:1rem; text-align:center; font-weight:600; display:flex; align-items:center; justify-content:center; gap:16px; min-height:60px;}
        .logo{height:40px; width:auto; background:#fff; padding:8px; border-radius:8px;}
        .wrap{width:min(1100px,100%); margin:0 auto; padding:24px 16px 40px}
        h1{font-size:clamp(22px,3vw,36px); text-align:center; margin:32px 0 24px}
        .card{background:var(--card); border:1px solid #e2e8f0; border-radius:var(--radius); padding:16px; box-shadow:0 8px 20px rgba(2,8,23,.04);}
        form{display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center; margin:8px 0;}
        @media (max-width:560px){ form{ grid-template-columns:1fr; } }
        label{position:absolute; left:-9999px}
        input[type="text"]{width:100%; padding:14px; border:1px solid #cbd5e1; border-radius:12px; font-size:16px; outline:none; transition:border-color .15s, box-shadow .15s;}
        input[type="text"]:focus{border-color:var(--brand); box-shadow:0 0 0 4px color-mix(in srgb, var(--brand) 20%, transparent);}
        .btn{padding:14px 20px; background:var(--brand); color:#fff; border:none; border-radius:12px; font-weight:600; cursor:pointer; font-size:16px; min-width:96px; transition:transform .02s, background .15s;}
        .btn:active{ transform: translateY(1px); } .btn:hover{ background:var(--brand-600); }
        .hint{color:var(--muted); font-size:.9rem; margin-top:6px}
        .state{display:none; align-items:center; gap:8px; color:var(--muted); font-size:.95rem; padding:10px}
        .spinner{width:18px; height:18px; border:3px solid #cbd5e1; border-top-color:var(--brand); border-radius:50%; animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .bad{color:#b91c1c}
        .result{margin-top:18px; border:1px solid #e2e8f0; border-radius:12px; overflow:hidden; background:#fff; min-height:120px; display:none}
        iframe{display:block; width:100%; border:0}
        footer{margin-top:auto; padding:14px; text-align:center; color:var(--muted); font-size:.9rem}
    </style>
    <link rel="icon" href="//ecoheal.net/cdn/shop/files/favicon_aa7a1eaf-f207-46ed-b5e1-396a81b29b76.png?crop=center&amp;height=48&amp;v=1724869205&amp;width=48" type="image/png">
</head>
<body>
<header>
    <img src="https://ecoheal.net/cdn/shop/files/Ecoheal_logo-2.png?v=1724870435&width=270" alt="EcoHeal Logo" class="logo">
    EcoHeal — Product verification
</header>

<main class="wrap">
    <h1>Serial number lookup / Authentication checker</h1>

    <section class="card">
        <form id="lookup-form" autocomplete="off" novalidate>
            <label for="serial">Enter your serial number</label>
            <input id="serial" name="serial" type="text" placeholder="Enter your serial number here" maxlength="64" />
            <button class="btn" type="submit" id="submit">Go</button>
        </form>
        <div class="hint">Allowed: letters, numbers, dash, underscore, dot.</div>

        <div id="status" class="state" role="status" aria-live="polite">
            <div class="spinner" aria-hidden="true"></div><span>Checking…</span>
        </div>

        <div id="result" class="result" aria-live="polite"></div>
        <div id="error" class="state bad" role="alert"></div>
    </section>
</main>

<footer>© <span id="y"></span> EcoHeal verification helper</footer>

<script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const form   = document.getElementById('lookup-form');
    const input  = document.getElementById('serial');
    const status = document.getElementById('status');
    const error  = document.getElementById('error');
    const box    = document.getElementById('result');

    // URL твоего Cloudflare Worker
    const API = 'https://misty-dew-46bc.levkorsy.workers.dev/api/verify';

    function setLoading(on) {
        status.style.display = on ? 'flex' : 'none';
        error.style.display  = 'none';
        if (on) box.style.display = 'none';
    }
    function showError(msg) {
        status.style.display = 'none';
        error.textContent = msg;
        error.style.display = 'flex';
        box.style.display = 'none';
    }

    async function verifySerial(serial) {
        const res = await fetch(`${API}?serial=${encodeURIComponent(serial)}`, { method: 'GET' });
        if (!res.ok) throw new Error(`API ${res.status}`);
        return res.json();
    }

    function renderHtmlIsolated(html) {
        // безопасная изоляция: вставляем в sandboxed iframe через srcdoc
        const iframe = document.createElement('iframe');
        iframe.setAttribute('sandbox', 'allow-forms allow-same-origin'); // без скриптов
        iframe.style.width = '100%';
        iframe.style.minHeight = '120px';
        iframe.srcdoc = `<!doctype html><meta charset="utf-8">${html || '<em>No data</em>'}`;
        iframe.onload = () => {
            // авто-высота по содержимому
            try {
                const h = iframe.contentWindow.document.body.scrollHeight || 300;
                iframe.style.height = Math.max(180, Math.min(h, 900)) + 'px';
            } catch (_) { iframe.style.height = '420px'; }
        };
        box.replaceChildren(iframe);
        box.style.display = 'block';
    }

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const value = (input.value || '').trim();
        if (!value) { showError('Please enter a serial number.'); input.focus(); return; }
        // if (!/^[A-Za-z0-9\-_.]{1,64}$/.test(value)) { showError('Invalid format. Use letters, numbers, dash, underscore or dot.'); input.focus(); return; }

        setLoading(true);
        try {
            const data = await verifySerial(value);
            setLoading(false);
            renderHtmlIsolated(data?.html);
        } catch (err) {
            showError('Request failed: ' + err.message);
        }
    });

    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') { e.preventDefault(); form.requestSubmit(); }
    });
</script>
</body>
</html>
