<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Serial number lookup / Authentication checker</title>
    <style>
        :root {
            --brand:#207a69; --brand-600:#1a6658; --text:#0f172a; --muted:#64748b; --bg:#ffffff; --card:#f8fafc;
            --radius:14px;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
            color:var(--text); background:var(--bg);
            display:flex; flex-direction:column;
        }
        header{
            background:var(--brand); color:#fff; padding:.5rem 1rem; text-align:center; font-weight:600;
        }
        .wrap{width:min(1100px,100%); margin:0 auto; padding:24px 16px 40px}
        h1{font-size:clamp(22px,3vw,36px); text-align:center; margin:32px 0 24px}
        .card{
            background:var(--card); border:1px solid #e2e8f0; border-radius:var(--radius);
            padding:16px; box-shadow:0 8px 20px rgba(2,8,23,.04);
        }
        form{
            display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center;
            margin:8px 0;
        }
        @media (max-width:560px){ form{ grid-template-columns:1fr; } }
        label{position:absolute; left:-9999px} /* accessible but hidden */
        input[type="text"]{
            width:100%; padding:14px 14px; border:1px solid #cbd5e1; border-radius:12px;
            font-size:16px; outline:none; transition:border-color .15s, box-shadow .15s;
        }
        input[type="text"]:focus{
            border-color:var(--brand); box-shadow:0 0 0 4px color-mix(in srgb, var(--brand) 20%, transparent);
        }
        .btn{
            padding:14px 20px; background:var(--brand); color:#fff; border:none; border-radius:12px;
            font-weight:600; cursor:pointer; font-size:16px; min-width:96px;
            transition:transform .02s ease, background .15s ease;
        }
        .btn:active{ transform: translateY(1px); }
        .btn:hover{ background:var(--brand-600); }
        .hint{color:var(--muted); font-size:.9rem; margin-top:6px}
        .result{
            margin-top:18px; border:1px solid #e2e8f0; border-radius:12px; overflow:hidden; background:#fff;
            min-height:120px; display:none;
        }
        iframe{display:block; width:100%; height:min(70vh,900px); border:0}
        .state{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:.95rem; padding:10px}
        .spinner{
            width:18px; height:18px; border:3px solid #cbd5e1; border-top-color:var(--brand);
            border-radius:50%; animation:spin 1s linear infinite;
        }
        @keyframes spin{to{transform:rotate(360deg)}}
        .bad{color:#b91c1c}
        footer{margin-top:auto; padding:14px; text-align:center; color:var(--muted); font-size:.9rem}
    </style>
</head>
<body>
<header>EcoHeal — Serial number lookup</header>
<main class="wrap">
    <h1>Serial number lookup / Authentication checker</h1>

    <section class="card" aria-labelledby="lookup-title">
        <form id="lookup-form" autocomplete="off" novalidate>
            <label for="serial">Enter your serial number</label>
            <input id="serial" name="serial" type="text" inputmode="latin"
                   placeholder="Enter your serial number here"
                   aria-describedby="help"
                   maxlength="64"
                   pattern="[A-Za-z0-9\-_.]{1,64}" />
            <button class="btn" type="submit" id="submit">Go</button>
        </form>
        <div id="help" class="hint">Allowed: letters, numbers, dash, underscore, dot.</div>

        <div id="status" class="state" role="status" aria-live="polite" style="display:none;">
            <div class="spinner" aria-hidden="true"></div>
            <span>Checking…</span>
        </div>

        <div id="result" class="result" aria-live="polite">
            <iframe id="resultFrame" title="Verification result"></iframe>
        </div>

        <div id="error" class="state bad" role="alert" style="display:none;"></div>
    </section>
</main>

<footer>© <span id="y"></span> EcoHeal verification helper</footer>

<script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const form   = document.getElementById('lookup-form');
    const input  = document.getElementById('serial');
    const status = document.getElementById('status');
    const error  = document.getElementById('error');
    const box    = document.getElementById('result');

    const BASE = 'https://ecoheal.net/apps/product-registration';

    function setLoading(on) {
        status.style.display = on ? 'flex' : 'none';
        error.style.display  = 'none';
        box.style.display    = on ? 'none' : box.style.display;
    }

    function showError(msg) {
        status.style.display = 'none';
        error.textContent = msg;
        error.style.display = 'flex';
        box.style.display = 'none';
    }

    // update iframe src and handle load/error
    function loadResult(serial) {
        const BASE = 'https://ecoheal.net/apps/product-registration';
        const url = `${BASE}?validateSerialNumber=true&serialNumber=${encodeURIComponent(serial)}&render=1&_=${Date.now()}`; // cache-buster

        setLoading(true);
        box.style.display = 'block';

        // Всегда берём актуальный iframe из DOM
        const frame = document.getElementById('resultFrame');

        // Сбрасываем прошлые обработчики (на случай повторных сабмитов)
        frame.onload = null;

        // Ставим новый обработчик завершения загрузки
        frame.onload = () => setLoading(false);

        // Обновляем src — браузер сделает новый запрос (из-за &_=timestamp)
        frame.src = url;
    }

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const value = (input.value || '').trim();
        if (!value) {
            showError('Please enter a serial number.');
            input.focus();
            return;
        }
        // pattern check (same as input pattern)
        if (!/^[A-Za-z0-9\-_.]{1,64}$/.test(value)) {
            showError('Invalid format. Use letters, numbers, dash, underscore or dot.');
            input.focus();
            return;
        }
        loadResult(value);
    });

    // Submit on Enter when input focused on mobile “Go” key
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') { e.preventDefault(); form.requestSubmit(); }
    });
</script>
</body>
</html>
